{% extends "layout.njk" %}

{% block content %}
<div class="container col-10 offset-1">
  <div class="alert alert-primary" role="alert" id="message">
    Géolocalisation en cours... pour récupérer les prévisions météo du lieu où vous êtes<br />
  </div>
  <p>
    Bike or Car? Va vous aider tous les jours à décider si vous voulez aller travailler en vélo ou en voiture, en analysant :
      <ul>
        <li>la pluie</li>
        <li>la température</li>
        <li>la neige</li>
        <li>le vent</li>
      </ul>
  </p>
  <p>
    Chaque matin, un petit coup d'oeil à l'application. Aller au travail en vélo sera toujours un plaisir. Pas de galère, pas de surprise.
  </p>
</div>

<script>
var options = {
  enableHighAccuracy: true,
  timeout: 10000,
  maximumAge: 0
};
function success(pos) {
  const crd = pos.coords;
  document.getElementById("message").innerHTML = "Merci. Géolocalisation OK.<br />Je débute le téléchargement de la météo.";
  window.location = "/latitude/" + crd.latitude + "/longitude/" + crd.longitude;
};

function error(err) {
  console.warn("ERROR(" + err.code + "): " + err.message);
  document.getElementById("message").innerHTML = "Erreur. Voici le message.<br />Code erreur : " + err.code + "<br />Message : " + err.message + "<br /> Cliquez ici pour ré-essayer sur <a href=\"https://bikeorcar.herokuapp.com\">https://bikeorcar.herokuapp.com</a>";
};

  navigator.geolocation.getCurrentPosition(success, error, options);
</script>
{% endblock %}
